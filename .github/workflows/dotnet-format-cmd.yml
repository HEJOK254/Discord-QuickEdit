name: .NET Manual Format
on:
  issue_comment:
    types: created

jobs:
  format:
    if: ${{ github.event.issue.pull_request && github.event.comment.author_association == 'COLLABORATOR' && startsWith(github.event.comment.body, '/format') }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 8.0.x
      - name: Restore dependencies
        run: dotnet restore
      - name: Format solution
        run: dotnet format 'Discord QuickEdit.sln' --no-restore
      - name: Commit changes
        run: |
          git add .
          git commit -m "Format code" -m "Manual format triggered by: ${{github.event.sender.name}}"
          git push
      - name: Report failure
        if: failure()
        uses: actions/github-script@v7
        with:
          github-token: ${{secrets.GITHUB_TOKEN}}
          script: |
            github.rest.issues.createComment({
              issue_number: ${{github.event.issue.id}},
              owner: ${{github.event.repository.owner}},
              repo: ${{github.event.repository}},
              body: 'Formatting failed'
            })
      - name: Report success
        if: success()
        uses: actions/github-script@v7
        with:
          github-token: ${{secrets.GITHUB_TOKEN}}
          script: |
            github.rest.issues.createComment({
              issue_number: ${{github.event.issue.id}},
              owner: ${{github.event.repository.owner}},
              repo: ${{github.event.repository}},
              body: 'Successfully formatted'
            })